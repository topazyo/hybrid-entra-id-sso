# Monitoring Guide

This document provides detailed instructions and best practices for monitoring the Hybrid Entra ID SSO Integration Suite. Effective monitoring is crucial for maintaining security, availability, and performance.

## Core Monitoring Areas

1.  **Identity Synchronization Health**:
    *   **Metrics**:
        *   Sync cycle latency.
        *   Number of synchronization errors (export/import).
        *   Pending synchronizations.
        *   Azure AD Connect service status.
    *   **Tools**:
        *   `scripts/monitoring/Monitor-EntraIDHealth.ps1`: Provides a snapshot of Entra ID health.
        *   `src/monitoring/IdentitySyncMonitor.ts`: Custom monitor for deeper insights (if further developed).
        *   Azure AD Connect Health dashboard in the Azure portal.
    *   **Alerts**: Configure alerts for high sync latency, repeated sync failures, or if the Azure AD Connect service is down.

2.  **Authentication Service Health**:
    *   **Metrics**:
        *   Authentication success/failure rates.
        *   Authentication latency (overall and per provider).
        *   Error rates for each component in the `src/auth` and `src/services` related to authentication.
        *   Status of connections to external dependencies (e.g., Mainframe, databases).
    *   **Tools**:
        *   Application Performance Monitoring (APM) tools (e.g., Azure Application Insights).
        *   Logging from `src/middleware/AuditLoggingMiddleware.ts`.
    *   **Alerts**: High failure rates, significant increase in latency, critical errors in authentication components.

3.  **Mainframe Integration Layer**:
    *   **Metrics**:
        *   Mainframe connection status and availability.
        *   Session translation success/failure rates.
        *   Latency of mainframe requests.
        *   Error rates from `src/integrations/MainframeIntegrationLayer.ts` and `src/middleware/MainframeAuthBridge.ts`.
    *   **Tools**:
        *   Logs from the integration components.
        *   Network monitoring between the integration layer and the mainframe.
    *   **Alerts**: Mainframe connectivity issues, high rate of session translation failures, increased latency.

4.  **Risk-Based Access Policy Engine**:
    *   **Metrics**:
        *   Number of risk assessments performed.
        *   Distribution of risk scores.
        *   Number of times MFA was triggered by the risk engine.
        *   Number of access denials due to high risk.
        *   Performance of the `src/security/RiskEngine.ts` and `src/services/AdaptiveAccessControl.ts`.
    *   **Tools**:
        *   Logs from the policy engine and risk assessment components.
        *   `src/services/AuditLogger.ts` for policy decisions.
    *   **Alerts**: Anomalous risk score distributions, failures in the risk assessment process, sudden spike in high-risk authentications.

5.  **System Performance & Resource Utilization**:
    *   **Metrics**:
        *   CPU, memory, network, and disk I/O for all servers/services.
        *   Request queue lengths.
        *   Response times for critical APIs.
    *   **Tools**:
        *   Azure Monitor for Azure-hosted resources.
        *   OS-level monitoring tools for on-premises components.
    *   **Alerts**: High resource utilization, long queue lengths, slow API responses.

6.  **Security Event Monitoring**:
    *   **Metrics**:
        *   Number and type of security alerts generated by `src/services/AlertService.ts`.
        *   Detected anomalies by `src/services/AnomalyDetection.ts` or `src/services/BehavioralAnalytics.ts`.
        *   Policy violations detected by `src/security/PolicyEnforcementPoint.ts`.
    *   **Tools**:
        *   SIEM system (e.g., Azure Sentinel) integrated with `src/integrations/AzureMonitorIntegration.ts`.
        *   Dashboards visualizing security events and trends.
    *   **Alerts**: Critical security alerts, detection of known threat patterns, significant policy violations.

## Logging Best Practices

*   **Structured Logging**: Use JSON or another structured format for logs to facilitate easier parsing and querying. The `utils/Logger.ts` should enforce this.
*   **Correlation IDs**: Include a correlation ID in all log entries related to a single request or transaction. This helps in tracing the flow of operations across different components.
*   **Sensitive Data**: Ensure no sensitive data (passwords, raw tokens, PII beyond what's necessary for audit) is logged in plain text.
*   **Log Levels**: Utilize appropriate log levels (e.g., DEBUG, INFO, WARN, ERROR, CRITICAL) to control verbosity and identify critical issues quickly.
*   **Centralized Logging**: Aggregate logs from all components into a centralized logging solution (e.g., Azure Log Analytics via `src/integrations/AzureMonitorIntegration.ts`).

## Alerting Strategy

*   **Severity Levels**: Define clear severity levels for alerts (e.g., Critical, High, Medium, Low).
*   **Notification Channels**: Configure appropriate notification channels for different alert severities (e.g., email, SMS, PagerDuty, Slack).
*   **Actionable Alerts**: Ensure alerts are actionable and provide enough context for quick investigation and remediation.
*   **Regular Review**: Regularly review and fine-tune alert thresholds and rules to minimize false positives and ensure important events are not missed.

## Key Monitoring Scripts & Tools

*   **`scripts/monitoring/Monitor-EntraIDHealth.ps1`**: Checks overall Entra ID health.
*   **`scripts/monitoring/IdentityMonitor.ts`**: (If fully implemented) Provides detailed identity synchronization monitoring.
*   **Azure Portal**:
    *   Azure AD Connect Health.
    *   Azure Monitor (Log Analytics, Application Insights, Metrics, Alerts).
*   **`src/controllers/HealthCheckController.ts` / `src/controllers/HealthController.ts`**: API endpoints for automated health checks.

This guide should be used as a starting point. The specific metrics and alerts will need to be tailored to the deployment environment and organizational requirements.
